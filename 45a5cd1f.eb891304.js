(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{144:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return c})),n.d(t,"metadata",(function(){return r})),n.d(t,"rightToc",(function(){return s})),n.d(t,"default",(function(){return d}));var a=n(2),o=n(10),i=(n(0),n(165)),c={id:"concepts",title:"Concepts",sidebar_label:"Concepts"},r={id:"concepts",isDocsHomePage:!1,title:"Concepts",description:"Local Context",source:"@site/docs/concepts.md",permalink:"/typedraft-docs/docs/concepts",editUrl:"https://github.com/mistlog/typedraft-docs/edit/master/docs/concepts.md",sidebar_label:"Concepts",sidebar:"someSidebar",previous:{title:"TypeDraft in 5 minutes",permalink:"/typedraft-docs/docs/"}},s=[{value:"Local Context",id:"local-context",children:[]},{value:"Transcribe",id:"transcribe",children:[]},{value:"DSL",id:"dsl",children:[]}],l={rightToc:s};function d(e){var t=e.components,n=Object(o.a)(e,["components"]);return Object(i.b)("wrapper",Object(a.a)({},l,n,{components:t,mdxType:"MDXLayout"}),Object(i.b)("h2",{id:"local-context"},"Local Context"),Object(i.b)("p",null,"Local context is function that used as standalone JSX Element. You can change the order of them because they are just plain function declarations, thus you can put important context first and let the code follows your design."),Object(i.b)("p",null,'The params in local context function declaration are not "real" params, they are identifiers used in this context, we write them just for compiler and avoid "undefined ... found". In this way, you still get the full power of typescript.'),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-typescript"}),"<VirtualMachine /> +\n    function Load(this: VirtualMachine & IVirtualMachine, image: Image) {\n        const reduced = image.reduce((commands: Array<ICommand>, current: ICommand) => {\n            <HandleLabelRelated />;\n            commands.push(current);\n            return commands;\n        }, []);\n        this.m_CommandList.push(...reduced);\n    };\n")),Object(i.b)("p",null,"For example, in the implementation of ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/mistlog/jack-vm/blob/master/source-view/core/vm.md#load"}),"jack vm"),", we extract the logic of ",Object(i.b)("inlineCode",{parentName:"p"},"HandleLabelRelated")," to a local context, thus the logic in the ",Object(i.b)("inlineCode",{parentName:"p"},"Load")," method of ",Object(i.b)("inlineCode",{parentName:"p"},"VirtualMachine")," is straightforward."),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-typescript"}),"function HandleLabelRelated(this: VirtualMachine & IVirtualMachine, current: ICommand, commands: Array<ICommand>) {\n    const index = commands.length;\n    if (current instanceof Label) {\n        current.Register(this, index);\n        return commands;\n    } else if (current instanceof DeclareFunction) {\n        current.RegisterLabel(this, index);\n    }\n}\n")),Object(i.b)("p",null,"To leverage type check of typescript, we add missing variables to the argument list and they will be removed after transcription."),Object(i.b)("h2",{id:"transcribe"},"Transcribe"),Object(i.b)("p",null,'Transcription is the process that transforms code with local context to plain typescript. The word "transcribe" is coined to differentiate it from words such as "compile" or "transpile".'),Object(i.b)("p",null,"Language we use today all are used to write code that runs. Instead of designed to be executed, code in typedraft is designed to be manipulated. "),Object(i.b)("p",null,'The order of code is not the order of execution, for example, it doesn\'t make sense to "add" a function to a JSX element or to declare a function that used as standalone JSX element. The order of code follows our thought, write important one first and keep trivial one as appendix.'),Object(i.b)("p",null,'That\'s why this language is called "draft" as opposed to "script". It encourages us to write code for human to read and reason about, in the same way we write articles. For more details of this style of programming, please refer to ',Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://en.wikipedia.org/wiki/Literate_programming"}),"literate programming"),"."),Object(i.b)("h2",{id:"dsl"},"DSL"),Object(i.b)("p",null,"To be more expressive, the mode ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://babeljs.io/"}),"babel")," takes is baked into typedraft. We can extend this language with customized DSL. "),Object(i.b)("p",null,"Take ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/mistlog/draft-dsl-match"}),"draft-dsl-match")," as an example, and you can see it in action in ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://mistlog.github.io/typedraft-playground/"}),"typedraft playground"),":"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-typescript"}),'enum Type {\n    Type1,\n    Type2\n}\n\nexport function Main(value: any) {\n    <Match />;\n}\n\nfunction Match(value: any) {\n    "use match";\n\n    (value: "a") => {\n        console.log("value is a");\n    };\n\n    (value: 1) => {\n        <HandleValueIsNumber />;\n    };\n\n    (value: Type.Type1) => {\n        console.log("value is type1");\n    };\n\n    () => {\n        console.log("default here");\n    };\n}\n\nfunction HandleValueIsNumber() {\n    console.log("value is 1");\n}\n\n')),Object(i.b)("p",null,"The result will be:"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-typescript"}),'enum Type {\n  Type1,\n  Type2,\n}\nexport function Main(value: any) {\n  if (value === "a") {\n    console.log("value is a");\n  } else if (value === 1) {\n    console.log("value is 1");\n  } else if (value === Type.Type1) {\n    console.log("value is type1");\n  } else {\n    console.log("default here");\n  }\n}\n')),Object(i.b)("p",null,'It\'s clear from this example that we use arrow function to denote case we want to match, this is possible because the context is clear, since we declare the DSL we want to use at the beginning of a local context: "use match".'),Object(i.b)("p",null,"In this way, the rest of statements is customizable, and you can reinterpret the semantics of them by implementing a DSL. "),Object(i.b)("p",null,"TypeDraft uses babel under the hood to transform code, and the way we implement a DSL is almost the same way we implement a plugin in babel. For babel plugin, see ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/jamiebuilds/babel-handbook/blob/master/translations/en/plugin-handbook.md#toc-get-the-path-of-a-sub-node"}),"babel plugin handbook"),". "),Object(i.b)("p",null,"For implementing DSL, see repo ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/mistlog/draft-dsl-match"}),"draft-dsl-match"),", and examples in ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/mistlog/typedraft/blob/0.1.9/test/plug-in/plugin.test.ts#L178"}),"unit test"),"."))}d.isMDXComponent=!0}}]);